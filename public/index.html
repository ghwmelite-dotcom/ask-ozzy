<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>AskOzzy ‚Äî AI Assistant for GoG Operations</title>
  <meta name="description" content="AskOzzy is a private, AI-powered productivity platform built exclusively for Government of Ghana (GoG) operations." />

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#0f1117" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#f5f3ef" media="(prefers-color-scheme: light)" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="AskOzzy" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="AskOzzy" />
  <meta name="msapplication-TileColor" content="#0f1117" />
  <meta name="msapplication-tap-highlight" content="no" />
  <link rel="manifest" href="/manifest.json" />
  <link rel="apple-touch-icon" href="/icons/icon-192.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/app.css" />
  <link rel="icon" href="/icons/icon.svg" type="image/svg+xml" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@9/build/index.umd.min.js" defer></script>
</head>
<body>

  <!-- ‚ïê‚ïê‚ïê Main App (always visible) ‚ïê‚ïê‚ïê -->
  <div id="app-screen" class="app-container">
    <div class="flag-stripe" style="position:fixed;top:0;left:0;right:0;z-index:999;"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar" style="margin-top:3px;">
      <div class="sidebar-header">
        <div class="sidebar-logo">
          <div class="logo-icon"></div>
          <h1>AskOzzy <span>AI for All GoG Staff</span></h1>
        </div>
      </div>

      <button class="btn-new-chat" onclick="requireAuth(createNewChat)">
        <span>+</span> New Conversation
      </button>

      <div class="offline-queue-badge" id="offline-queue-badge" style="display:none;" title="Messages queued while offline">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v10l4.5 4.5"/><circle cx="12" cy="12" r="10"/></svg>
        <span id="offline-queue-count">0</span> queued offline
      </div>

      <div class="conversation-list" id="conversation-list">
        <div class="section-label">Recent Conversations</div>
      </div>

      <!-- Footer: changes based on auth state -->
      <div class="sidebar-footer" id="sidebar-footer">
        <!-- Populated by JS -->
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content" style="margin-top:3px;">
      <header class="main-header">
        <button class="btn-toggle-sidebar" onclick="toggleSidebar()" title="Toggle sidebar">‚ò∞</button>
        <select class="model-selector" id="model-selector" onchange="onModelChange()">
          <optgroup label="Premium Models (Paid Plans)">
            <option value="@cf/openai/gpt-oss-120b">üîí GPT-OSS 120B ‚Äî OpenAI (Best)</option>
            <option value="@cf/meta/llama-4-scout-17b-16e-instruct">üîí Llama 4 Scout 17B ‚Äî Meta</option>
            <option value="@cf/meta/llama-3.3-70b-instruct-fp8-fast">üîí Llama 3.3 70B ‚Äî Meta</option>
            <option value="@cf/deepseek-ai/deepseek-r1-distill-qwen-32b">üîí DeepSeek R1 32B ‚Äî Reasoning</option>
            <option value="@cf/qwen/qwq-32b">üîí QwQ 32B ‚Äî Qwen (Deep Thinking)</option>
            <option value="@cf/qwen/qwen3-30b-a3b-fp8">üîí Qwen3 30B ‚Äî Qwen (Latest)</option>
            <option value="@cf/mistralai/mistral-small-3.1-24b-instruct">üîí Mistral Small 3.1 24B</option>
            <option value="@cf/ibm-granite/granite-4.0-h-micro">üîí Granite 4.0 ‚Äî IBM</option>
          </optgroup>
          <optgroup label="Free Models">
            <option value="@cf/openai/gpt-oss-20b" selected>GPT-OSS 20B ‚Äî OpenAI (Fast)</option>
            <option value="@cf/google/gemma-3-12b-it">Gemma 3 12B ‚Äî Google</option>
            <option value="@cf/meta/llama-3.1-8b-instruct-fast">Llama 3.1 8B Fast ‚Äî Instant</option>
          </optgroup>
        </select>
        <div class="usage-badge" id="usage-badge" onclick="openPricingModal()" title="Click to view plans"></div>
        <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode" aria-label="Toggle light/dark mode">
          <div class="theme-toggle-track">
            <span class="theme-toggle-icon-dark">&#x1F319;</span>
            <span class="theme-toggle-icon-light">&#x2600;&#xFE0F;</span>
            <div class="theme-toggle-thumb"></div>
          </div>
        </button>
        <div class="lang-selector-wrap" style="position:relative;">
          <button class="lang-selector" id="lang-selector" onclick="openLanguageMenu()" title="Select language">EN</button>
        </div>
        <button class="header-help-btn" onclick="openGuide()" title="User Guide (Ctrl+/)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
        </button>
        <div class="offline-status-badge" id="offline-status-badge">
          <span class="offline-status-dot"></span>
          <span class="offline-status-text">Online</span>
        </div>
        <div class="privacy-badge">Private & Encrypted</div>
      </header>

      <!-- Announcements Area -->
      <div id="announcements-area"></div>

      <!-- Welcome Screen -->
      <div id="welcome-screen" class="welcome-screen">
        <div class="welcome-logo">‚ö°</div>
        <h2>Welcome to AskOzzy</h2>
        <p>Your private AI assistant for GoG operations. Choose a template below or start a free conversation.</p>

        <div class="sovereignty-badge">
          <div class="sovereignty-icon">
            <svg width="28" height="28" viewBox="0 0 64 64" fill="none"><path d="M16 16c0 8 4 14 10 16v16h4V32c6-2 10-8 10-16" stroke="var(--green-light)" stroke-width="3" fill="none" stroke-linecap="round"/><path d="M16 16c-4 4-6 10-4 16 2 5 6 8 10 8" stroke="var(--green-light)" stroke-width="3" fill="none" stroke-linecap="round"/><path d="M40 16c4 4 6 10 4 16-2 5-6 8-10 8" stroke="var(--green-light)" stroke-width="3" fill="none" stroke-linecap="round"/><circle cx="20" cy="16" r="3" fill="var(--green-light)"/><circle cx="36" cy="16" r="3" fill="var(--green-light)"/></svg>
          </div>
          <div class="sovereignty-text">
            <strong>Your data stays in Ghana.</strong>
            <span>Sovereign. Private. Yours.</span>
          </div>
        </div>

        <div class="category-tabs" id="category-tabs"></div>
        <div class="template-grid" id="template-grid"></div>
      </div>

      <!-- Chat Screen -->
      <div id="chat-screen" class="hidden" style="display:flex;flex-direction:column;flex:1;min-height:0;">
        <div class="chat-area" id="chat-area">
          <div class="chat-messages" id="chat-messages"></div>
        </div>

        <div class="input-area">
          <div class="input-wrapper" id="input-wrapper">
            <textarea
              id="chat-input"
              rows="1"
              placeholder="Ask Ozzy anything..."
              onkeydown="handleInputKeydown(event)"
              oninput="autoResizeInput()"
            ></textarea>
            <!-- Voice Recording Indicator (shown when recording) -->
            <div class="voice-recording-indicator" id="voice-recording-indicator">
              <div class="voice-waveform" id="voice-waveform">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
              </div>
              <span class="voice-listening-label" id="voice-listening-label">Listening...</span>
              <span class="voice-timer" id="voice-timer">0:00</span>
            </div>
            <div class="input-actions">
              <div class="input-actions-left">
                <button class="input-action-btn" onclick="openFileUpload()" title="Attach file">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                </button>
                <button class="input-action-btn" onclick="openImageUpload()" title="Upload image">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                </button>
                <button class="input-action-btn" onclick="openCamera()" title="Take a photo">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                </button>
                <button class="input-action-btn" id="btn-web-search" onclick="toggleWebSearch()" title="Web search">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                </button>
              </div>
              <div class="input-actions-right">
                <button class="input-action-btn" id="btn-voice" onclick="toggleVoice()" title="Voice input">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                </button>
                <button class="input-action-btn" id="btn-voice-mode" onclick="toggleVoiceMode()" title="Voice conversation mode">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 18v-6a9 9 0 0 1 18 0v6"/><path d="M21 19a2 2 0 0 1-2 2h-1a2 2 0 0 1-2-2v-3a2 2 0 0 1 2-2h3zM3 19a2 2 0 0 0 2 2h1a2 2 0 0 0 2-2v-3a2 2 0 0 0-2-2H3z"/></svg>
                </button>
                <!-- Large Voice Input Button -->
                <button class="voice-btn" id="voice-btn-large" onclick="toggleVoice()" title="Tap to speak">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>
                </button>
                <button class="btn-send" id="btn-send" onclick="sendMessage()" disabled title="Send message">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="19" x2="12" y2="5"/><polyline points="5 12 12 5 19 12"/></svg>
                </button>
              </div>
            </div>
          </div>

          <div class="input-tools">
            <button class="tool-pill" onclick="openTemplateModal()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
              Templates
            </button>
            <button class="tool-pill" onclick="openDeepResearch()" title="Multi-step research with web sources">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
              Deep Research
            </button>
            <button class="tool-pill" onclick="openDataAnalysis()" title="Upload CSV/XLSX for AI analysis">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>
              Analyze Data
            </button>
            <button class="tool-pill" onclick="openWorkflows()" title="Guided document workflows">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
              Workflows
            </button>
            <button class="tool-pill" onclick="openMeetingAssistant()" title="Upload and transcribe meetings">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/></svg>
              Meetings
            </button>
            <button class="tool-pill" onclick="openSpaces()" title="Collaborate with your team">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
              Spaces
            </button>
            <button class="tool-pill" onclick="state.activeConversationId && shareConversation(state.activeConversationId)" id="btn-share" style="display:none;">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
              Share
            </button>
          </div>

          <div class="input-disclaimer">
            AskOzzy may produce inaccurate information. Verify critical details.
            <span class="shortcut-hint"><kbd>Ctrl</kbd>+<kbd>K</kbd> Search</span>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- ‚ïê‚ïê‚ïê Auth Modal ‚ïê‚ïê‚ïê -->
  <div class="modal-overlay" id="auth-modal">
    <div class="modal auth-modal">
      <div class="modal-header">
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="auth-modal-icon">‚ö°</div>
          <div>
            <h3 id="auth-modal-title">Sign in to AskOzzy</h3>
            <p style="font-size:12px;color:var(--text-muted);margin:0;">Your conversations are private and encrypted</p>
          </div>
        </div>
        <button class="modal-close" onclick="closeAuthModal()">‚úï</button>
      </div>
      <div class="modal-body" style="padding:24px;">
        <div id="auth-error" class="auth-error"></div>

        <!-- Login Form -->
        <form id="login-form">
          <div class="form-group">
            <label>Email Address</label>
            <input type="email" id="login-email" placeholder="your.name@gov.gh" required />
          </div>
          <div class="form-group">
            <label>Access Code</label>
            <input type="text" id="login-access-code" class="access-code-input" placeholder="e.g. 7K9F-M2XH" required autocomplete="off" spellcheck="false" />
          </div>
          <button type="submit" class="btn-auth">Sign In</button>
        </form>

        <!-- Register Form -->
        <form id="register-form" class="hidden">
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="reg-name" placeholder="e.g. Kwame Asante" required />
          </div>
          <div class="form-group">
            <label>Email Address</label>
            <input type="email" id="reg-email" placeholder="your.name@gov.gh" required />
          </div>
          <div class="form-group">
            <label>Department / MDA</label>
            <input type="text" id="reg-dept" placeholder="e.g. Ministry of Finance" />
          </div>
          <div class="form-group">
            <label style="font-size:11px;color:var(--text-muted);text-transform:none;letter-spacing:0;">Referral Code (optional)</label>
            <input type="text" id="reg-referral" placeholder="e.g. OZZY-KWAME" />
          </div>
          <button type="submit" class="btn-auth">Create Account</button>
        </form>

        <div class="auth-toggle">
          <span id="toggle-text">Don't have an account?</span>
          <a id="auth-toggle-link" onclick="toggleAuthForm()">Create one</a>
        </div>

        <div class="privacy-banner" style="margin-top:16px;">
          <strong>üîí Your Privacy Matters</strong>
          Unlike ChatGPT and other public tools, your data never leaves this platform. Complete confidentiality for government work.
        </div>

        <!-- Code Reveal (shown after registration) -->
        <div id="code-reveal" class="hidden">
          <div style="text-align:center;padding:8px 0;">
            <div style="font-size:48px;margin-bottom:12px;">üîê</div>
            <h3 style="font-size:20px;font-weight:700;margin-bottom:8px;color:var(--text-primary);">Your Access Code</h3>
            <p style="font-size:13px;color:var(--text-secondary);margin-bottom:20px;">Use this code to sign in. Save it somewhere safe!</p>
            <div id="reveal-code-display" class="access-code-input" style="font-size:32px;letter-spacing:6px;color:var(--gold);background:var(--bg-tertiary);border:2px dashed var(--gold-dim);border-radius:12px;padding:20px;margin:0 auto 16px;display:inline-block;min-width:260px;font-weight:700;"></div>
            <div style="margin-bottom:16px;">
              <button type="button" id="btn-copy-code" onclick="copyAccessCode()" style="background:var(--gold);color:var(--text-on-accent);border:none;border-radius:8px;padding:10px 24px;font-size:14px;font-weight:600;cursor:pointer;transition:all 0.2s;">Copy Code</button>
            </div>
            <p style="font-size:12px;color:var(--red-error-text);font-weight:600;margin-bottom:20px;">This code will only be shown once!</p>
            <button type="button" onclick="finishRegistration()" style="width:100%;padding:12px;background:linear-gradient(135deg, var(--green), var(--green-light));color:var(--text-on-green);border:none;border-radius:8px;font-size:14px;font-weight:700;cursor:pointer;transition:all 0.2s;">I've Saved My Code ‚Äî Continue ‚Üí</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Affiliate Modal ‚ïê‚ïê‚ïê -->
  <div class="modal-overlay" id="affiliate-modal">
    <div class="modal" style="max-width:560px;">
      <div class="modal-header">
        <h3>üí∞ AskOzzy Affiliate Programme</h3>
        <button class="modal-close" onclick="closeAffiliateModal()">‚úï</button>
      </div>
      <div class="modal-body" id="affiliate-modal-body">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Template Modal ‚ïê‚ïê‚ïê -->
  <div class="modal-overlay" id="template-modal">
    <div class="modal">
      <div class="modal-header">
        <h3>üìã Prompt Templates</h3>
        <button class="modal-close" onclick="closeTemplateModal()">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="modal-categories" id="modal-categories"></div>
        <div class="modal-template-list" id="modal-template-list"></div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Pricing Modal ‚ïê‚ïê‚ïê -->
  <div class="modal-overlay" id="pricing-modal">
    <div class="modal pricing-modal-box">
      <div class="modal-header">
        <div>
          <h3>Choose Your Plan</h3>
          <p style="font-size:12px;color:var(--text-muted);margin:4px 0 0;">Unlock premium AI models and unlimited productivity</p>
        </div>
        <button class="modal-close" onclick="closePricingModal()">‚úï</button>
      </div>
      <div class="modal-body" id="pricing-modal-body" style="padding:24px;">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê Upgrade Limit Banner (injected by JS when limit reached) ‚ïê‚ïê‚ïê -->

  <!-- Guide Help FAB -->
  <button class="guide-fab" onclick="openGuide()" title="User Guide" aria-label="Open user guide">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
  </button>

  <!-- Citizen Service Bot Launcher -->
  <button class="citizen-bot-fab" onclick="openCitizenBot()" title="Ask Ozzy ‚Äî Citizen Services" aria-label="Open citizen services chat">
    <svg class="citizen-fab-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
    <svg class="citizen-fab-close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
  </button>

  <script src="/js/templates.js"></script>
  <script src="/js/app.js"></script>
</body>
</html>
